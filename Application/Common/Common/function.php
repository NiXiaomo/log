<?php/** * Created by PhpStorm. * User: xiaomo * Date: 2016/9/2 * Time: 9:29 *//** * 日志记录，./Public/files/log.xml * @param $log_content */function logger($log_content){    $max_size = 10000;    $log_filename = "./Public/files/log.xml";    if (file_exists($log_filename) and (abs(filesize($log_filename)) > $max_size)) {        file_put_contents($log_filename, "");    }    file_put_contents($log_filename, date('Y-m-d H:i:s') . " " . $log_content . "\r\n", FILE_APPEND);}/** * * 基础分页的相同代码封装，使前台的代码更少 * * @param $m 模型，引用传递 * @param $where 查询条件 * @param int $pageSize 每页查询条数 * @param string $join join查询字符串 * @return \Think\Page */function init_page(&$m, $where, $pageSize = 10, $join = ''){    $m1 = clone $m; // 浅复制一个模型    $count = $m->join($join)->where($where)->count();   // 连惯操作后会对join等操作进行重置    $m = $m1;//为保持在为定的连惯操作，浅复制一个模型    $p = new Think\Page($count, $pageSize);    $p->lastSuffix = false;    $p->setConfig('header', '<span class="rows">共<b>%TOTAL_ROW%</b>条记录&nbsp;&nbsp;每页<b>' . $pageSize        . '</b>条&nbsp;&nbsp;第<b>%NOW_PAGE%</b>页/共<b>%TOTAL_PAGE%</b>页</span>');    $p->setConfig('prev', '上一页');    $p->setConfig('next', '下一页');    $p->setConfig('last', '末页');    $p->setConfig('first', '首页');    $p->setConfig('theme', '%FIRST% %UP_PAGE% %LINK_PAGE% %DOWN_PAGE% %END% %HEADER%');    return $p;}/** * 推送评论信息 * @param $user * @return mixed */function pushed_comment($user){    // 回复我或评论我的文章，且不是我自己做的    $userWhere['log_post.user'] = $user;    $userWhere['comment_respond'] = $user;    $userWhere['_logic'] = "or";    $where['_complex'] = $userWhere;    // 复合查询    $where['log_post.status'] = 1;    $where['comment_pushed'] = 2;    $where['log_comment.user'] = array('neq', $user);    return M("comment")->field("comment_id,post_id,log_comment.user,comment_respond,comment_date,log_comment.content,comment_parent")        ->join("RIGHT JOIN log_post ON log_comment.post_id = log_post.id")->where($where)        ->order("comment_date desc, comment_id desc")->select();}